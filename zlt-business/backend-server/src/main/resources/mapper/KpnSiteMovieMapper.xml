<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.central.backend.mapper.KpnSiteMovieMapper">
    <select id="findList" resultType="com.central.backend.model.vo.KpnSiteMovieVO">
        select t.id,t.movie_id as movieId,t.name_zh as nameZh,t.name_en as nameEn,t.name_kh as nameKh,
               t.cover_url as coverUrl,t.actor_id as actorId,t.actor_name_zh as actorNameZh,t.actor_name_en as actorNameEn,t.actor_name_kh as actorNameKh,
               t.vv as vv,t.favorites as favorites,t.pay_type as payType,t.update_time as updateTime,t.update_by as updateBy,t.status as status
        from kpn_site_movie t
        <where>
         1=1
            <if test="p.movieId != null and  p.movieId != '' and p.movieId !=0">
                and t.movie_id LIKE CONCAT('%',#{p.movieId},'%')
            </if>
            <if test="p.siteId != null and  p.siteId != ''">
                and t.site_id LIKE CONCAT('%',#{p.siteId},'%')
            </if>
            <if test="p.nameZh != null and  p.nameZh != ''">
                and t.name_zh LIKE CONCAT('%',#{p.nameZh},'%')
            </if>
            <if test="p.nameEn != null and  p.nameEn != ''">
                and t.name_en LIKE CONCAT('%',#{p.nameEn},'%')
            </if>
            <if test="p.nameKh != null and  p.nameKh != ''">
                and t.name_kh LIKE CONCAT('%',#{p.nameKh},'%')
            </if>
            <if test="p.movieNameZh != null and  p.movieNameZh != ''">
                and t.actor_name_zh LIKE CONCAT('%',#{p.movieNameZh},'%')
            </if>
            <if test="p.movieNameEn != null and  p.movieNameEn != ''">
                and t.actor_name_en LIKE CONCAT('%',#{p.movieNameEn},'%')
            </if>
            <if test="p.movieNameKh != null and  p.movieNameKh != ''">
                and t.actor_name_kh LIKE CONCAT('%',#{p.nameKh},'%')
            </if>
            <if test="p.startTime!=null and  p.startTime != ''">
                and DATE_FORMAT(t.update_time,'%Y-%m-%d %H:%i:%s') <![CDATA[ >= ]]>DATE_FORMAT(#{p.startTime},'%Y-%m-%d %H:%i:%s')
            </if>
            <if test="p.endTime!=null and  p.endTime != ''">
                and DATE_FORMAT(t.update_time,'%Y-%m-%d %H:%i:%s') <![CDATA[ <= ]]>DATE_FORMAT(#{p.endTime},'%Y-%m-%d %H:%i:%s')
            </if>
            <if test="p.status != null and  p.status != ''">
                and t.status LIKE CONCAT('%',#{p.status},'%')
            </if>
            <if test="p.country != null and  p.country != ''">
                and t.country LIKE CONCAT('%',#{p.country},'%')
            </if>
            <if test="p.type != null and  p.type != ''">
                and t.type LIKE CONCAT('%',#{p.type},'%')
            </if>
            <if test="p.shootingType != null and  p.shootingType != ''">
                and t.shooting_type LIKE CONCAT('%',#{p.shootingType},'%')
            </if>
            <if test="p.subtitleType != null and  p.subtitleType != ''">
                and t.subtitle_type LIKE CONCAT('%',#{p.subtitleType},'%')
            </if>
            <if test="p.payType != null and  p.payType != ''">
                and t.pay_type LIKE CONCAT('%',#{p.payType},'%')
            </if>
             ORDER BY t.create_time DESC
        </where>
    </select>

    <update id="updateBatchStatusById">
        <foreach collection="list" item="item" separator=";">
            update
            `kpn_site_movie`
            set
            `status` = #{item.status}
            where
            id = #{item.id}
        </foreach>
    </update>

    <update id="updateBatchPayTypeById">
        <foreach collection="list" item="item" separator=";">
            update
            `kpn_site_movie`
            set
            `pay_type` = #{item.payType}
            where
            id = #{item.id}
        </foreach>
    </update>

</mapper>